---
title: "Gapminder Exploration"
author: "Kenny Chiu"
date: "2019-09-24"
output: html_document
---



## Introduction

we explore the `gapminder` dataset available in the `gapminder` R package. This exploration also uses the `tidyverse` R package.

```{r, echo=FALSE}
library(gapminder)
suppressPackageStartupMessages(library(tidyverse))
knitr::opts_chunk$set(fig.align = "center")
```



## Exercise 1: Basic `dplyr`


### 1.1

We filter the `gapminder` data to include only data from Canada, the United States, and Taiwan in the 1970's.

```{r 1.1}
df = filter(gapminder,
            country == "Canada" | country == "United States" | country == "Taiwan",
            year >= 1970 & year <= 1979)
df %>%
  knitr::kable(digits = c(1, 0, 2))
```


### 1.2

We extract the `country` and `gdpPercap` variables from the filtered dataset.

```{r 1.2}
df %>%
  select(country, gdpPercap) %>%
  knitr::kable(digits = 2)
```


### 1.3

We filter the `gapminder` dataset to all entries that have experienced a drop in life expectancy.

```{r 1.3}
gapminder %>%
  group_by(continent, country) %>%
  mutate(lifeExp_inc = lifeExp - lag(lifeExp, order_by = year)) %>%
  filter(lifeExp_inc < 0) %>%
  DT::datatable() %>%
  DT::formatRound(columns = c("lifeExp", "gdpPercap", "lifeExp_inc"),
                  digits = 2)
```


### 1.4

We filter the `gapminder` dataset so that it shows the max GDP per capita experienced by each country.

```{r 1.4}
gapminder %>%
  group_by(country) %>%
  filter(gdpPercap == max(gdpPercap)) %>%
  DT::datatable() %>%
  DT::formatRound(columns = c("lifeExp", "gdpPercap"),
                  digits = c(1, 2))
```


### 1.5 TODO

We produce a scatterplot of Canada's life expectancy vs log GDP per capita.

```{r 1.5}
gapminder %>%
  filter(country == "Canada") %>%
  ggplot(aes(gdpPercap, lifeExp)) +
  geom_point()
  #scale_x_log10()
  #scale_x_log10("GDP per capita", labels = scales::dollar_format())
```



## Exercise 2: Explore individual variables with `dplyr` TODO


### Exploration: `continent`

We explore the `continent` variable in the `gapminder` dataset. The `continent` variable is a categorical variable that codes the continent that the observation is for. The following bar graph shows the possible values of the continent variable and the number of observations for each in the dataset.

```{r 2.continent}
gapminder %>%
  group_by(continent) %>%
  summarize(num_obs = length(continent)) %>%
  ggplot(aes(continent, num_obs)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = num_obs), vjust = -0.3) +
  labs(title = "Number of Observations per Continent",
       x = "Continent",
       y = "Count")
```

We see that Africa has a large number of observations (624) whereas Oceania only has a few (24). The difference between number of observations available for each continent can be explained by the following plot which shows the number of distinct countries in each continent.

```{r 2.continent.country}
gapminder %>%
  select(continent, country) %>%
  distinct() %>%
  group_by(continent) %>%
  summarize(num_obs = length(continent)) %>%
  ggplot(aes(continent, num_obs)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = num_obs), vjust = -0.3) +
  labs(title = "Number of Countries per Continent",
       x = "Continent",
       y = "Number of Countries")
```

We see that there are more countries in Africa than in Oceania. This explains why the dataset would have more observations for certain continents compared to others.


### Exploration: `lifeExp`

We explore the `lifeExp` variable in the `gapminder` dataset. The `lifeExp` variable is a quantitative variable that codes the life expectancy at birth in years. The following histogram shows the distribution of `lifeExp`.

```{r 2.lifeExp}
gapminder %>%
  ggplot(aes(lifeExp)) +
  geom_histogram(bins = 40) +
  labs(title = "Histogram of Life Expectancy",
       x = "Life Expectancy",
       y = "Count")
```

The distribution can be seen as unimodal with a long left-skew or as bimodal with a small second peak. The distribution of life expectancy peaks at around 70 to 74 years. The relevant summary statistics for `lifeExp` are shown below.

```{r 2.lifeExp.summary}
# Note:
# summary() outputs a named vector which cannot be converted into a data frame directly.
# Extract names and values separately and place them into a data frame manually.

lifeExp_sum = summary(gapminder$lifeExp)
sum_names = names(lifeExp_sum)

lifeExp_sum = as.vector(lifeExp_sum) %>%
  t() %>%
  round(1) %>%
  as.data.frame()
names(lifeExp_sum) = sum_names

knitr::kable(lifeExp_sum)
```

We see that the life expectancy ranges from 23.6 years to 82.6 years. The median is 60.7 years with an IQR of `r 70.8-48.2` years.



## Exercise 3: Explore various plot types


```{r}
df = gapminder
```


## Recycling

```{r}
filter(gapminder, country == c("Rwanda", "Afghanistan"))
```

